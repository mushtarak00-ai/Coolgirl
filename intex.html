<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Toxicity % + Comment Softener</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, Helvetica, sans-serif; max-width: 900px; margin: 36px auto; padding: 12px; }
    h1 { margin-bottom: 6px; }
    textarea { width: 100%; height: 120px; font-size: 16px; padding: 8px; box-sizing: border-box; }
    button { padding: 10px 18px; font-size: 15px; cursor: pointer; margin-right: 8px; }
    #controls { margin-top: 8px; }
    #summary { margin-top: 18px; padding: 12px; border-radius: 6px; background: #f7f7f7; }
    .percent { font-size: 28px; font-weight: 700; }
    .level-low { color: #006400; }
    .level-medium { color: #b36b00; }
    .level-high { color: #c62828; }
    #replacements { margin-top: 10px; color: #b30000; }
    #softened { margin-top: 12px; padding: 10px; background: #eef9f0; border-radius: 6px; }
    #original { margin-top: 6px; padding: 10px; background: #fff8e1; border-radius: 6px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { text-align: left; padding: 6px 8px; border-bottom: 1px solid #eee; }
    .small { font-size: 13px; color: #666; }
  </style>
</head>
<body>
  <h1>Toxicity % Detector & Comment Softener</h1>
  <p class="small">Enter a comment below. The tool will compute a toxicity percentage, list toxic matches and then output a softened (cooler) version.</p>

  <textarea id="comment" placeholder="Type or paste a comment (e.g. 'You are such an idiot')"></textarea>

  <div id="controls">
    <button id="analyzeBtn">Analyze & Soften</button>
    <button id="clearBtn">Clear</button>
  </div>

  <div id="summary" aria-live="polite" style="display:none;">
    <div><strong>Toxicity:</strong> <span id="percent" class="percent"></span></div>
    <div class="small">Interpretation: <span id="level"></span></div>

    <div id="countsArea" style="display:none;">
      <h3 style="margin-top:12px;margin-bottom:6px;">Detected toxic words</h3>
      <table id="countsTable">
        <thead><tr><th>Word</th><th>Count</th><th>Replacement</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="original">
      <strong>Original:</strong>
      <div id="originalText" style="margin-top:6px;"></div>
    </div>

    <div id="softened">
      <strong>Softened (cooler) version:</strong>
      <div id="softenedText" style="margin-top:6px;"></div>
    </div>

    <div id="note" class="small" style="margin-top:10px;">
      <strong>How percentage is calculated:</strong> (toxic word occurrences / total words) Ã— 100. Whole-word matching only; punctuation ignored.
    </div>
  </div>

  <script>
    // Replacement dictionary (expanded)
    const replacements = {
      // Common toxic words
      "idiot": "clever",
      "stupid": "smart",
      "dumb": "wise",
      "hate": "love",
      "ugly": "beautiful",
      "trash": "valuable",
      "screw": "help",
      "damn": "good",
      "bitch": "friend",
      "asshole": "kind person",
      "jerk": "nice person",
      "fool": "genius",
      "disgusting": "pleasant",

      // Gen Z / slang insults
      "cringe": "cool",
      "basic": "unique",
      "salty": "calm",
      "sus": "trustworthy",
      "thot": "respectful person",
      "bet": "definitely",
      "tea": "information",
      "clapback": "response",
      "ghost": "ignore politely",
      "slay": "shine",
      "shade": "compliment",
      "dead": "alive",
      "lit": "great",
      "savage": "kind",
      "woke": "aware",
      "flex": "show",

      // Jargon / common insults
      "moron": "intelligent person",
      "loser": "winner",
      "dick": "gentleman",
      "bastard": "hero",
      "twat": "friend",
      "prick": "pal",
      "shithead": "nice person",
      "douche": "cool person",
      "pissed": "upset",
      "jerkoff": "nice guy",
      "dumbass": "smart person"
    };

    // Build regex for detection (escape keys safely)
    function escapeRegex(s) {
      return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // Build alternation string like \b(?:idiot|stupid|...)\b
    const toxicKeys = Object.keys(replacements).map(escapeRegex);
    const toxicPattern = toxicKeys.length ? `\\b(?:${toxicKeys.join('|')})\\b` : null;
    const toxicRegex = toxicPattern ? new RegExp(toxicPattern, 'gi') : null;

    const analyzeBtn = document.getElementById('analyzeBtn');
    const clearBtn = document.getElementById('clearBtn');

    analyzeBtn.addEventListener('click', analyzeAndSoften);
    clearBtn.addEventListener('click', () => {
      document.getElementById('comment').value = '';
      document.getElementById('summary').style.display = 'none';
    });

    function analyzeAndSoften() {
      const raw = document.getElementById('comment').value;
      const summary = document.getElementById('summary');
      const percentEl = document.getElementById('percent');
      const levelEl = document.getElementById('level');
      const countsArea = document.getElementById('countsArea');
      const countsBody = document.querySelector('#countsTable tbody');
      const originalText = document.getElementById('originalText');
      const softenedText = document.getElementById('softenedText');

      // Reset
      countsBody.innerHTML = '';
      countsArea.style.display = 'none';
      originalText.textContent = '';
      softenedText.textContent = '';

      const text = (raw || '').trim();
      if (!text) {
        alert('Please enter a comment to analyze.');
        return;
      }

      // Count total words (simple word tokenization)
      const wordMatches = text.match(/\b\w+\b/g) || [];
      const totalWords = wordMatches.length;

      // Find toxic matches
      let toxicMatches = [];
      if (toxicRegex) {
        const allMatches = text.match(toxicRegex) || [];
        // normalize to lowercase for counting
        toxicMatches = allMatches.map(m => m.toLowerCase());
      }

      const toxicCount = toxicMatches.length;
      const percent = totalWords === 0 ? 0 : Math.round((toxicCount / totalWords) * 100);

      // Interpret level
      let level = '';
      let levelClass = '';
      if (percent === 0) {
        level = 'None';
        levelClass = 'level-low';
      } else if (percent > 0 && percent <= 10) {
        level = 'Low';
        levelClass = 'level-low';
      } else if (percent > 10 && percent <= 30) {
        level = 'Medium';
        levelClass = 'level-medium';
      } else {
        level = 'High';
        levelClass = 'level-high';
      }

      // Build counts table (word -> count)
      const counts = {};
      toxicMatches.forEach(w => counts[w] = (counts[w] || 0) + 1);

      // Show counts if any
      if (Object.keys(counts).length > 0) {
        countsArea.style.display = 'block';
        for (const [word, cnt] of Object.entries(counts)) {
          const tr = document.createElement('tr');
          const tdWord = document.createElement('td');
          tdWord.textContent = word;
          const tdCount = document.createElement('td');
          tdCount.textContent = cnt;
          const tdRepl = document.createElement('td');
          tdRepl.textContent = replacements[word] || '(no replacement)';
          tr.appendChild(tdWord);
          tr.appendChild(tdCount);
          tr.appendChild(tdRepl);
          countsBody.appendChild(tr);
        }
      }

      // Create softened version using replacement by whole-word regex, preserving capitalization
      let softened = text;
      if (toxicRegex) {
        // For each toxic key, replace its occurrences globally
        for (const toxicWord of Object.keys(replacements)) {
          const escaped = escapeRegex(toxicWord);
          const r = new RegExp(`\\b${escaped}\\b`, 'gi');
          softened = softened.replace(r, function(match) {
            const repl = replacements[toxicWord];
            // preserve capitalization of first letter
            if (match[0] === match[0].toUpperCase()) {
              return repl.charAt(0).toUpperCase() + repl.slice(1);
            }
            return repl;
          });
        }
      }

      // Show results
      percentEl.textContent = `${percent}%`;
      percentEl.className = 'percent ' + levelClass;
      levelEl.textContent = level;
      levelEl.className = levelClass;

      originalText.textContent = text;
      softenedText.textContent = softened;

      summary.style.display = 'block';
    }

    // Optional: allow Enter+Ctrl to submit
    document.getElementById('comment').addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        analyzeAndSoften();
      }
    });
  </script>
</body>
</html>